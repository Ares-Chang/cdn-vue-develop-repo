<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CDN Vue develop config</title>
    <!-- Vue@3.2.47 {@link https://cn.vuejs.org/} -->
    <script src="https://unpkg.com/vue@3.2.47/dist/vue.global.prod.js"></script>
    <!-- Vue 文件转换库 {@link https://github.com/FranckFreiburger/vue3-sfc-loader} -->
    <script src="https://unpkg.com/vue3-sfc-loader@0.8.4/dist/vue3-sfc-loader.js"></script>
    <!-- Unocss Attributify {@link https://github.com/unocss/unocss/tree/main/packages/runtime} -->
    <script src="https://cdn.jsdelivr.net/npm/@unocss/runtime/attributify.global.js"></script>
    <!-- Vue Demi {@link https://github.com/vueuse/vue-demi} -->
    <script src="https://cdn.jsdelivr.net/npm/vue-demi@0.13.11"></script>
    <!-- VueUse {@link https://vueuse.org/} -->
    <script src="https://unpkg.com/@vueuse/shared"></script>
    <script src="https://unpkg.com/@vueuse/core"></script>
    <!-- Pinia {@link https://pinia.vuejs.org/zh/} {@link 参考 https://github.com/vuejs/pinia/discussions/1051}  -->
    <script src="https://cdn.jsdelivr.net/npm/pinia"></script>

    <!-- Pinia useStore 自定义函数 -->
    <script src="./src/store/count.js"></script>

    <style>
      [v-cloak],
      [un-cloak] {
        display: none !important;
      }
    </style>
  </head>

  <body m0>
    <div id="app" v-cloak>
      <my-page un-cloak></my-page>
    </div>
  </body>

  <script>
    const { createApp } = Vue
    const { loadModule } = window['vue3-sfc-loader']
    const { createPinia } = Pinia

    const options = {
      moduleCache: {
        vue: Vue
      },
      async getFile(url) {
        const res = await fetch(url)
        if (!res.ok)
          throw Object.assign(new Error(res.statusText + ' ' + url), { res })
        return {
          getContentData: asBinary =>
            asBinary ? res.arrayBuffer() : res.text()
        }
      },
      addStyle(textContent) {
        const style = Object.assign(document.createElement('style'), {
          textContent
        })
        const ref = document.head.getElementsByTagName('style')[0] || null
        document.head.insertBefore(style, ref)
      }
    }

    createApp({
      components: {
        // 引入页面
        'my-page': Vue.defineAsyncComponent(() =>
          loadModule('./src/pages/welcome/index.vue', options)
        )
      }
    })
      .use(createPinia())
      .mount('#app')
  </script>
</html>
